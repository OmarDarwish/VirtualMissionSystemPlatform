<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans 
	http://www.springframework.org/schema/beans/spring-beans.xsd 
	http://camel.apache.org/schema/spring 
	http://camel.apache.org/schema/spring/camel-spring.xsd">

	<!-- Properties setup bean -->
	<bean id="properties"
		class="org.apache.camel.component.properties.PropertiesComponent">
		<property name="location" value="classpath:vmsp-esb.properties" />
	</bean>

	<!-- ActiveMQ endpoint connection setup -->
	<bean id="activemq" class="org.apache.activemq.camel.component.ActiveMQComponent">
		<property name="brokerURL" value="tcp://localhost:61616" />
	</bean>

	<!-- Processor beans -->
	<bean id="pbxProcessor" class="edu.utdesign.rwc.vmsp.esb.PbxProcessor" />
	<bean id="messageServerProcessor" class="edu.utdesign.rwc.vmsp.esb.MessageServerProcessor" />

	<!-- Singleton data beans -->
	<bean id="aggregateSystem" class="edu.utdesign.rwc.vmsp.esb.AggregateSystem" />

	<camelContext xmlns="http://camel.apache.org/schema/spring">
		<dataFormats>
			<castor mappingFile="castor/mapping.xml" id="castor" />
		</dataFormats>

		<route id="fromMessageServer">
			<from uri="activemq:{{activemq.in}}" />
			<unmarshal ref="castor" />
			<log message="Received message from MessageServer:" />
			<log message=" ${body.body}" />
			<bean ref="messageServerProcessor" />
		</route>

		<route id="toMessageServer">
			<from uri="direct:start" />
			<marshal ref="castor" />
			<to uri="activemq:{{activemq.out}}" />
		</route>

		<route id="messageServerStatus">
			<from uri="activemq:{{activemq.status}}" />
			<unmarshal ref="castor" />
			<log message="Received status from MesseageServer:" />
			<log
				message=" InRadio messsages received: ${body.getInRadio.getNumMessagesReceived}" />
			<log
				message=" OutRadio messsages sent: ${body.getOutRadio.getNumMessagesSent}" />
			<bean ref="messageServerProcessor" />
		</route>

		<route id="pbxToBean">
			<from uri="netty:tcp://{{netty.host}}:{{netty.port}}?sync=false" />
			<unmarshal ref="castor" />
			<log message="Received info from PBX" />
			<bean ref="pbxProcessor" />
			<to uri="mock:result" />
		</route>
	</camelContext>
</beans>